# -- General Settings ----------------------------------------------------------

# Fix colors and enable true color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Action: Remap prefix from 'C-b' to 'C-a' (Matches your comment)
# If you prefer M-e, change 'C-a' to 'M-e' below.
unbind C-b
set-option -g prefix M-e
bind-key M-e send-prefix

# VITAL for Vim/Neovim users: Remove the delay when pressing Esc
set -s escape-time 0

# Increase scrollback buffer history size
set -g history-limit 50000

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on  # Renumber windows when one is closed

set -g focus-events on

# -- Key Bindings --------------------------------------------------------------

# Reload config
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Vim-like pane navigation
setw -g mode-keys vi
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resizing Panes (Added as requested)
# The '-r' flag allows you to hold the key to repeat the action
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Maximize/Restore a pane (zoom)
bind -r m resize-pane -Z

# Split windows (keeping current directory)
# Standard split is % and " but v and s are more intuitive
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# Use 'a' for a clean session list (collapsed view)
bind a choose-tree -Zs

# 'Space' to immediately switch to the previous session
bind Space switch-client -l

# Kill current session and switch to the next one (prevents dropping to shell)
bind X run-shell 'tmux switch-client -n \; kill-session -t "#S"'

# -- Copy Mode (Vim Style) -----------------------------------------------------

bind-key [ copy-mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Copy to system clipboard
# Note: 'xclip' is for X11, 'wl-copy' is for Wayland (Hyprland/Sway).
# If you are on macOS, keep your 'pbcopy' line.
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"

# -- Status Bar & Aesthetics ---------------------------------------------------

# Status bar background color 
set -g status-style bg=default

# Left: Session name in Blue/Bold
set -g status-left "#[fg=blue,bold,bg=default]  #S #[fg=white,nobold]| "

# Right: User @ Host | Time
set -g status-right "#[fg=white]  #(whoami) #[fg=green]  #H #[fg=blue]  %H:%M "

# Windows: Clean formatting
set -g window-status-format "#[fg=colour240] #I:#W"
set -g window-status-current-format "#[fg=green,bold] #I:#W"

# -- Scripts -------------------------------------------------------------------

# The Primeagen's tmux-sessionizer
bind-key -r f run-shell "tmux neww ~/.local/scripts/tmux-sessionizer"

# Smart pane switching with awareness of Vim splits.
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
